<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>allstack document</title>
</head>
<body>
    <iframe src="" frameborder="1" id="ifrm1"></iframe>
    <script>
        const form1 = document.querySelector('#form1');
        const infos = {};
        let resdata = '';

        function aaaaaaaaa(a,b,c,d) {
            console.log(a,b,c,d);
        }

        if( location.hash ) {   //google
            resdata = location.hash;
        }
        else if( location.search ) {    //github
            resdata = location.search;
        }
        else {
            console.log(location);
        }
        if( resdata ) {
            resdata.substring(1).split('&').forEach(h => {
                const hh = h.split('=');
                infos[hh[0]] = hh[1];
            });

            sessionStorage.removeItem('name');
            sessionStorage.removeItem('email');

            if( infos.access_token ) {  //google
                console.log('google');
                // https://www.googleapis.com/oauth2/v1/userinfo?access_token=ya29.a0AfB_byC6i8DEybS8aUWxFw_eUhai69BGtNbEJ6nevIU784TNIPgkpA4o1JZxlpAG8FqHKcJEe-LkFlLiBBLRQ4XQSck4ds_QnxbpxVFeEmenoi_LmNhF6VnSvqgrNla0LlnijBuGg_Wt61cWjgTRGgn7q7kxPLoO_AaCgYKAWASARISFQHGX2MiL55A88NjTg8ScmdIuhK0Tg0169
                fetch(`https://www.googleapis.com/oauth2/v1/userinfo?access_token=${infos.access_token}`).then(res => {
                    console.log(res);
                    res.json().then(d => {
                        console.log(d);
                        for (const k in d) {
                            if (Object.hasOwnProperty.call(d, k)) {
                                sessionStorage.setItem(k, d[k]);
                            }
                        }
                        // location.href = '/';
                    });
                });
            }
            else if( infos.code ) { //github
                // curl --location --request POST 'https://github.com/login/oauth/access_token?client_id=1feec8b27f62e46c8dd8&client_secret=1bfdfcecd18ace3741c14477cda89858843f11d2&code=6b304ede61d88cf01059'
                const postdata = {
                    'client_id': '1feec8b27f62e46c8dd8',
                    'client_secret': '1bfdfcecd18ace3741c14477cda89858843f11d2',
                    'code': infos.code,
                };
                document.querySelector('#ifrm1').src = 'https://github.com/login/oauth/access_token?callback=aaaaaaaaa&client_id=1feec8b27f62e46c8dd8&client_secret=1bfdfcecd18ace3741c14477cda89858843f11d2&code='+infos.code;
                fetch('https://github.com/login/oauth/access_token?callback=aaaaaaaaa&client_id=1feec8b27f62e46c8dd8&client_secret=1bfdfcecd18ace3741c14477cda89858843f11d2&code='+infos.code, {
                    method:'GET',
                    mode:'no-cors',
                    headers: {
                        // 'Content-Type': 'application/json',
                        'Origin': 'http://localhost:5000',
                        // 'Accept': 'application/json',
                    },
                    // body: JSON.stringify(postdata),
                }).then(res => {
                    console.log(res);
                    if( res.ok ) {
                        res.json().then(d => {
                            console.log(d);
                        });
                    }
                });
            }
        }
    </script>

</body>
</html>